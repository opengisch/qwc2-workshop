<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>QWC2 Workshop</title>
<meta name="author" content="Mario"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">QWC2 Workshop</h1><p class="subtitle"></p>
<h2 class="author">Mario</h2><p class="date">Created: 2022-11-23 Wed 11:32</p>
</section>
<style>
.reveal li {font-size: 60%;}
</style>

<section>
<section id="slide-orgd6d245c">
<h2 id="orgd6d245c"><span class="section-number-2">1.</span> Objectifs</h2>
<p>
Les objectifs de ce workshop sont :
</p>
<ul>
<li>de connaître les principales fonctionnalités de QWC2</li>
<li>être capable de créer une application web QWC2 simple</li>
<li>préparer une infrastructure Docker pour servir l'application web</li>
<li>configurer l'application web</li>
<li>configurer et publier des projets QGIS</li>

</ul>
</section>
</section>
<section>
<section id="slide-org86a05d1">
<h2 id="org86a05d1"><span class="section-number-2">2.</span> Qu'est-ce que QWC2 ?</h2>
<p>
QWC2 est un client web pour le serveur QGIS.
</p>


<div id="org99b4aae" class="figure">
<p><img src="./assets/images/simple.png" alt="simple.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-org6d299eb">
<h2 id="org6d299eb"><span class="section-number-2">3.</span> Composants</h2>
<div class="outline-text-2" id="text-3">
</div>
</section>
<section id="slide-orgc6810c4">
<h3 id="orgc6810c4"><span class="section-number-3">3.1.</span> Map Components</h3>
<ul>
<li>ReactJS + Redux</li>
<li>OpenLayers</li>

</ul>
</section>
<section id="slide-org6aac7f3">
<h3 id="org6aac7f3"><span class="section-number-3">3.2.</span> Build Toolchain</h3>
<ul>
<li>nodejs</li>
<li>yarn</li>
<li>webpack</li>

</ul>
</section>
<section id="slide-org6eb07a1">
<h3 id="org6eb07a1"><span class="section-number-3">3.3.</span> Build</h3>

<div id="org5a44528" class="figure">
<p><img src="./assets/images/build.png" alt="build.png" />
</p>
</div>
</section>
</section>
<section>
<section id="slide-orgce7a25d">
<h2 id="orgce7a25d"><span class="section-number-2">4.</span> Fonctionnalités</h2>
<div class="outline-text-2" id="text-4">
</div>
</section>
<section id="slide-orgc4b0b79">
<h3 id="orgc4b0b79"><span class="section-number-3">4.1.</span> Core modules</h3>
<ul>
<li>Navigateur de thème (projet)</li>
<li>Layer tree</li>
<li>Feature info</li>
<li>Recherche configurables</li>
<li>Outils de mesure</li>
<li>Fonctionnalité d'esquisse / redlining</li>
<li>Génération de liens permanents</li>
<li>Impression PDF</li>
<li>Exportation de captures d'écran / Raster</li>
<li>Importation WMS / WFS</li>
<li>Importation KML</li>
<li>Outil de comparaison de cartes</li>

</ul>
<p>
<a href="http://webgisdemo.opengis.ch:8811">http://webgisdemo.opengis.ch:8811</a>
</p>
</section>
<section id="slide-orgd518a1a">
<h3 id="orgd518a1a"><span class="section-number-3">4.2.</span> Fonctionnalités avec composants serveur (services REST)</h3>
<ul>
<li>Authentification</li>
<li>Gestion des utilisateurs</li>
<li>Recherche dans la base de données</li>
<li>Permalinks</li>
<li>Édition</li>
<li>Service Mapinfo (indépendant des couches)</li>
<li>Impression de légendes</li>
<li>Profils de hauteur</li>

</ul>
</section>
</section>
<section>
<section id="slide-org443140f">
<h2 id="org443140f"><span class="section-number-2">5.</span> Où le trouver ?</h2>
<ul>
<li><a href="https://github.com/qgis/qwc2">https://github.com/qgis/qwc2</a> Ce repository contient les composants
communs de l'application QWC2 à partir desquels vous
pouvez construire votre propre application QWC2 personnelle.</li>
<li><a href="https://github.com/qgis/qwc2-demo-app">https://github.com/qgis/qwc2-demo-app</a> Ce repository contient un
exemple d'application QWC2 que vous pouvez utiliser comme base pour
créer votre propre application.</li>
<li><a href="https://github.com/qwc-services">https://github.com/qwc-services</a> Cette organisation Github contient
les repository qui contiennent les composants serveur.</li>

</ul>
</section>
</section>
<section>
<section id="slide-org20d23e8">
<h2 id="org20d23e8"><span class="section-number-2">6.</span> Où trouver de l'aide ?</h2>
<ul>
<li><a href="https://github.com/qgis/qwc2-demo-app/blob/master/doc/QWC2_Documentation.md">https://github.com/qgis/qwc2-demo-app/blob/master/doc/QWC2_Documentation.md</a>
Documentation officielle</li>
<li><a href="https://github.com/qgis/qwc2-demo-app/issues">https://github.com/qgis/qwc2-demo-app/issues</a> Github issues</li>
<li><a href="https://lists.osgeo.org/mailman/listinfo/qgis-qwc2">https://lists.osgeo.org/mailman/listinfo/qgis-qwc2</a> Mailing list</li>
<li>OPENGIS.ch</li>

</ul>
</section>
</section>
<section>
<section id="slide-org7d0f2f0">
<h2 id="org7d0f2f0"><span class="section-number-2">7.</span> Requirements</h2>
<p>
Environnement de développement minimal
</p>
<ul>
<li>git</li>
<li>node</li>
<li>yarn</li>

</ul>
</section>
</section>
<section>
<section id="slide-org9953583">
<h2 id="org9953583"><span class="section-number-2">8.</span> Partie pratique</h2>
<p>
Serveur cloud en ligne ou machine locale avec ligne de commande Linux et docker
</p>
</section>
<section id="slide-org879c110">
<h3 id="org879c110"><span class="section-number-3">8.1.</span> Préparation des machine Exoscale</h3>
<p>
Swiss Cloud provider, avec servers en CH, DE, AT, BG.
</p>
<ul>
<li>Ubuntu 22.04 LTS (GVA)</li>
<li>Small</li>
<li>webserver and devservers groups</li>

</ul>
</section>
<section id="slide-org2d40520">
<h3 id="org2d40520"><span class="section-number-3">8.2.</span> Installation minimale de QWC2 (sans Docker)</h3>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>sudo bash
apt update
apt install nodejs npm unzip
npm install -g yarn
git clone --recursive https://github.com/qgis/qwc2-demo-app.git
cd qwc2-demo-app
yarn install
yarn start
</code></pre>
</div>

<p>
Nous allons à l'adresse &lt;IP ADDRESS&gt;:8081
</p>

<p>
Conseil : désactivez le cache du navigateur
</p>

<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>yarn run prod
ls ./prod
</code></pre>
</div>
</section>
<section id="slide-orgf2f278c">
<h3 id="orgf2f278c"><span class="section-number-3">8.3.</span> Conteneurisation à l'aide de Docker</h3>
<p>
Maintenant nous préparons un conteneur pour construire l'application
donc nous n'avons pas besoin de dépendances locales comme node etc. et
il est reproductible, nous utilisons docker-compose, de sorte que nous
pouvons ensuite ajouter les autres composants, un peu à la fois.
</p>

<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>apt install docker.io
apt install docker-compose
</code></pre>
</div>

<p>
Nous créons docker-compose.yml dans le répertoire <code>/home/ubuntu/</code>
</p>

<div class="org-src-container">

<pre  class="src src-yaml"   ><code trim>version: '3'

services:

  qwc2:
    image: node:18.10
    volumes:
      - ./qwc2-demo-app:/io/app
    command: &gt;
      bash -c "cd /io/app &amp;&amp;
               yarn install &amp;&amp;
               yarn start"
    ports:
      - 8081:8081
</code></pre>
</div>
</section>
<section id="slide-orge9c691f">
<h3 id="orge9c691f"><span class="section-number-3">8.4.</span> Webserver</h3>
<p>
Changeons-le maintenant car nous voulons seulement l'utiliser comme un
constructeur et ajouter un serveur web. Nous changeons donc la
dernière ligne de la 'commande' en <code>yarn run prod</code> et nous fermons les
ports&#x2026;
</p>

<p>
Nous avons maintenant un processus qui génère l'application dont nous
avons besoin. Nous allons mettre un serveur web maintenant. Caddy.
</p>

<p>
<a href="https://caddyserver.com/">https://caddyserver.com/</a>
<a href="https://hub.docker.com/_/caddy">https://hub.docker.com/_/caddy</a>
</p>

<p>
Nous modifions le docker-compose.yml en ajoutant le service caddy :
</p>
<div class="org-src-container">

<pre  class="src src-yaml"   ><code trim>caddy:
  image: caddy:2.6.2-alpine
  volumes:
    - ./qwc2-demo-app/prod:/usr/share/caddy
  ports:
    - 80:80
</code></pre>
</div>
</section>
<section id="slide-org2f4ba0d">
<h3 id="org2f4ba0d"><span class="section-number-3">8.5.</span> QGIS server</h3>
<p>
Maintenant, nous voulons ajouter notre propre projet qgis et ne pas
simplement utiliser des wms directs via un serveur géographique
externe. Ajoutons donc un serveur QGIS pour publier nos projets.
</p>

<p>
Nous téléchargeons l'un des projets d'exemple de QField
<a href="https://docs.qfield.org/get-started/sample-projects/">https://docs.qfield.org/get-started/sample-projects/</a>.
</p>
<div class="org-src-container">

<pre  class="src src-sh"   ><code trim>mkdir qgis
curl -L -O https://docs.qfield.org/assets/projects/simple-bee-farming.zip
unzip simple-bee-farming.zip -d simple_bee_farming
</code></pre>
</div>

<p>
Nous modifions le docker-compose.yml en ajoutant le service qgis-server :
</p>
<div class="org-src-container">

<pre  class="src src-yaml"   ><code trim>qgis-server:
  image: opengisch/qgis-server:3.28.0-jammy
  volumes:
    - ./qgis:/io/data
  expose:
    - 9993
  ports:
    - 8080:80
</code></pre>
</div>

<p>
Nous pouvons essayer les requêtes du navigateur directement
<a href="http://">http://</a>&lt;IP ADDRESS&gt;:8080/ogc/simple<sub>bee</sub><sub>farming</sub>?SERVICE=WMS&amp;REQUEST=GetProjectSettings
</p>

</section>
<section id="slide-org68bfa19">
<h3 id="org68bfa19"><span class="section-number-3">8.6.</span> Proxy avec Caddy</h3>
<p>
Mais certaines choses comme getFeatureInfo ne fonctionnent pas parce
qu'elles sont sur des URL différentes, nous devons nous assurer que
tout passe par le même endroit, c'est-à-dire caddy, ce qui a aussi
l'avantage, si nous utilisons HTTPS, de configurer les certificats en
un seul endroit.
</p>

<p>
Caddyfile
</p>
<pre  class="example" >
  194.182.160.95:80 {

  # Set this path to your site's directory.
  root * /usr/share/caddy

  # Enable the static file server.
  file_server

  log {
    level DEBUG
    output stdout
  }

  @ows {
    path_regexp map_file ^/ows/(.*)
  }

  # https://localhost/ows/bees?SERVICE=WMS&amp;REQUEST=GetCapabilities
  # directly call QGIS via fcgi
  reverse_proxy @ows qgis-server:9993 {
    transport fastcgi {
      env QUERY_STRING {query}&amp;map=/io/data/{http.regexp.map_file.1}/{http.regexp.map_file.1}.qgs
    }
  }
}
</pre>

<p>
docker-compose.yml
</p>
<div class="org-src-container">

<pre  class="src src-yaml"   ><code trim>caddy:
  image: caddy:2.6.2-alpine
  volumes:
    - ./qwc2-demo-app/prod:/usr/share/caddy
    - ./Caddyfile:/etc/caddy/Caddyfile
  ports:
    - 80:80
</code></pre>
</div>

<p>
Nous pouvons supprimer les ports de qgis-server et désactiver nginx
interne et utiliser seulement FastCGI.
</p>

<p>
FastCGI est une technique permettant la communication entre un serveur
HTTP et un logiciel indépendant, c'est une évolution de Common Gateway
Interface, abrégée en CGI, signifiant en anglais « Interface
passerelle commune ».
</p>
<div class="org-src-container">

<pre  class="src src-yaml"   ><code trim>expose:
  - 9993
environment:
  SKIP_NGINX: "true"
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-orgd4f2ab7">
<h2 id="orgd4f2ab7"><span class="section-number-2">9.</span> Configuration des thèmes et des projets</h2>
<ul>
<li>Print</li>
<li>Basemaps</li>
<li>&#x2026;</li>

</ul>
</section>
</section>
<section>
<section id="slide-org326f784">
<h2 id="org326f784"><span class="section-number-2">10.</span> Configuration de l'application</h2>
<ul>
<li>Desktop and Mobile</li>
<li>Disable plugins</li>

</ul>
</section>
</section>
<section>
<section id="slide-org2312af9">
<h2 id="org2312af9"><span class="section-number-2">11.</span> Search Providers</h2>
</section>
</section>
<section>
<section id="slide-orgaeb3554">
<h2 id="orgaeb3554"><span class="section-number-2">12.</span> WebGIS Signalo Structure</h2>
<p>
&#x2026;
</p>


<p>
Pascal:
194.182.163.132
ssh ubuntu@194.182.163.132
iD3hbgsjndkmcat
</p>

<p>
Fred:
194.182.162.239
ssh ubuntu@194.182.162.239
sR3efhfiefqhaet
</p>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
transition: 'cube',

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]

});

</script>
</body>
</html>
